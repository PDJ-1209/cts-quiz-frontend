<div class="login-container">
  <!-- Fancy Popup Notification -->
  @if (popup()) {
    <div class="fancy-popup-container">
      <div class="fancy-popup" 
           [class.popup-success]="popup()?.type === 'success'" 
           [class.popup-error]="popup()?.type === 'error'" 
           [class.popup-warning]="popup()?.type === 'warning'">
        <div class="popup-icon">
          @if (popup()?.type === 'success') {
            <span class="icon-checkmark">✓</span>
          } @else if (popup()?.type === 'error') {
            <span class="icon-cross">✕</span>
          } @else {
            <span class="icon-warning">⚠</span>
          }
        </div>
        <div class="popup-content">
          <p class="popup-message">{{ popup()?.message }}</p>
        </div>
        <button class="popup-close" (click)="closePopup()" aria-label="Close">×</button>
      </div>
    </div>
  }
  
  <div class="login-card">
    <div class="login-header">
      <img src="Cognizant_logo.png" alt="Cognizant" class="cognizant-logo">
      <h1 class="login-title">CTS Quiz Portal</h1>
      <p class="login-subtitle">{{ showRegistration() ? 'Create Your Account' : 'Welcome to the Assessment Platform' }}</p>
    </div>

    <!-- Login Form -->
    <form *ngIf="!showRegistration()" (ngSubmit)="onLogin()" #loginForm="ngForm" class="login-form">
      <div class="form-group">
        <label for="employeeId" class="form-label">
          <i class="fas fa-user"></i>
          Employee ID
        </label>
        <input
          type="text"
          id="employeeId"
          name="employeeId"
          [(ngModel)]="employeeId"
          #empId="ngModel"
          required
          class="form-control"
          placeholder="Enter your Employee ID"
          [class.error]="empId.invalid && empId.touched"
          autocomplete="username"
        />
        <div *ngIf="empId.invalid && empId.touched" class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          Employee ID is required
        </div>
      </div>

      <div class="form-group">
        <label for="password" class="form-label">
          <i class="fas fa-lock"></i>
          Password
        </label>
        <div class="password-container">
          <input
            [type]="showPassword() ? 'text' : 'password'"
            id="password"
            name="password"
            [(ngModel)]="password"
            #pwd="ngModel"
            required
            class="form-control"
            placeholder="Enter your password"
            [class.error]="pwd.invalid && pwd.touched"
            autocomplete="current-password"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="togglePasswordVisibility()"
            tabindex="-1"
          >
            <i [class]="showPassword() ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        <div *ngIf="pwd.invalid && pwd.touched" class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          Password is required
        </div>
      </div>

      <div *ngIf="loginError()" class="login-error">
        <i class="fas fa-exclamation-triangle"></i>
        {{ loginError() }}
      </div>

      <button
        type="submit"
        class="login-button"
        [disabled]="loginForm.invalid || isLoading()"
      >
        <span *ngIf="isLoading()" class="spinner"></span>
        <i *ngIf="!isLoading()" class="fas fa-sign-in-alt"></i>
        {{ isLoading() ? 'Signing In...' : 'Sign In' }}
      </button>
    </form>

    <!-- Registration Form -->
    <form *ngIf="showRegistration()" (ngSubmit)="onRegister()" #regForm="ngForm" class="login-form">
      <div class="form-group">
        <label for="regEmployeeId" class="form-label">
          <i class="fas fa-id-card"></i>
          Employee ID
        </label>
        <input
          type="text"
          id="regEmployeeId"
          name="regEmployeeId"
          [(ngModel)]="regEmployeeId"
          #empId="ngModel"
          required
          class="form-control"
          placeholder="Enter your Employee ID"
          [class.error]="empId.invalid && empId.touched"
          autocomplete="username"
        />
        <div *ngIf="empId.invalid && empId.touched" class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          Employee ID is required
        </div>
      </div>

      <div class="form-group">
        <label for="regEmail" class="form-label">
          <i class="fas fa-envelope"></i>
          Email Address
        </label>
        <input
          type="email"
          id="regEmail"
          name="regEmail"
          [(ngModel)]="regEmail"
          #email="ngModel"
          required
          email
          class="form-control"
          placeholder="Enter your email address"
          [class.error]="email.invalid && email.touched"
          autocomplete="email"
        />
        <div *ngIf="email.invalid && email.touched" class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          Valid email is required
        </div>
      </div>

      <div class="form-group">
        <label for="regFirstName" class="form-label">
          <i class="fas fa-user"></i>
          First Name
        </label>
        <input
          type="text"
          id="regFirstName"
          name="regFirstName"
          [(ngModel)]="regFirstName"
          #firstName="ngModel"
          required
          class="form-control"
          placeholder="Enter your first name"
          [class.error]="firstName.invalid && firstName.touched"
          autocomplete="given-name"
        />
        <div *ngIf="firstName.invalid && firstName.touched" class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          First name is required
        </div>
      </div>

      <div class="form-group">
        <label for="regLastName" class="form-label">
          <i class="fas fa-user"></i>
          Last Name
        </label>
        <input
          type="text"
          id="regLastName"
          name="regLastName"
          [(ngModel)]="regLastName"
          #lastName="ngModel"
          required
          class="form-control"
          placeholder="Enter your last name"
          [class.error]="lastName.invalid && lastName.touched"
          autocomplete="family-name"
        />
        <div *ngIf="lastName.invalid && lastName.touched" class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          Last name is required
        </div>
      </div>

      <div class="form-group">
        <label for="regPassword" class="form-label">
          <i class="fas fa-lock"></i>
          Password
        </label>
        <input
          type="password"
          id="regPassword"
          name="regPassword"
          [(ngModel)]="regPassword"
          #pwd="ngModel"
          required
          minlength="6"
          class="form-control"
          placeholder="Enter your password"
          [class.error]="pwd.invalid && pwd.touched"
          autocomplete="new-password"
        />
        <div *ngIf="pwd.invalid && pwd.touched" class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          Password must be at least 6 characters
        </div>
      </div>

      <div class="form-group">
        <label for="regConfirmPassword" class="form-label">
          <i class="fas fa-lock"></i>
          Confirm Password
        </label>
        <input
          type="password"
          id="regConfirmPassword"
          name="regConfirmPassword"
          [(ngModel)]="regConfirmPassword"
          #confirmPwd="ngModel"
          required
          class="form-control"
          placeholder="Confirm your password"
          [class.error]="confirmPwd.invalid && confirmPwd.touched"
          autocomplete="new-password"
        />
        <div *ngIf="confirmPwd.invalid && confirmPwd.touched" class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          Please confirm your password
        </div>
      </div>

      <div *ngIf="registrationError()" class="login-error">
        <i class="fas fa-exclamation-triangle"></i>
        {{ registrationError() }}
      </div>

      <div *ngIf="registrationSuccess()" class="success-message">
        <i class="fas fa-check-circle"></i>
        {{ registrationSuccess() }}
      </div>

      <button
        type="submit"
        class="login-button"
        [disabled]="regForm.invalid || isLoading()"
      >
        <span *ngIf="isLoading()" class="spinner"></span>
        <i *ngIf="!isLoading()" class="fas fa-user-plus"></i>
        {{ isLoading() ? 'Creating Account...' : 'Create Account' }}
      </button>
    </form>

    <div class="login-footer">
      <p class="help-text">
        <i class="fas fa-info-circle"></i>
        For assistance, contact IT Support
      </p>
      
      <div class="registration-link">
        <p>Don't have an account? 
          <a href="#" (click)="showRegistration.set(!showRegistration()); $event.preventDefault()" class="register-link">
            {{ showRegistration() ? 'Back to Login' : 'Register Here' }}
          </a>
        </p>
      </div>
      
      <div class="role-info">
        <div class="role-badge admin">
          <i class="fas fa-crown"></i>
          Admin Portal
        </div>
        <div class="role-badge host">
          <i class="fas fa-user-tie"></i>
          Host Dashboard
        </div>
        <div class="role-badge user">
          <i class="fas fa-users"></i>
          Participant Portal
        </div>
      </div>
    </div>
  </div>

  <div class="login-background">
    <div class="pattern-overlay"></div>
  </div>
</div>

