<div class="chatbot-container" [class.open]="isOpen()" [class.minimized]="isMinimized()">
  <!-- Floating Button -->
  <button class="chatbot-fab" (click)="toggleChat()" *ngIf="!isOpen()" title="Open AI Assistant">
    <span class="fab-icon">ğŸ¤–</span>
    <span class="fab-label">AI Assistant</span>
  </button>

  <!-- Chat Window -->
  <div class="chat-window" *ngIf="isOpen()">
    <!-- Header -->
    <div class="chat-header">
      <div class="header-content">
        <h3 class="chat-title">
          <span class="title-icon">âœ¨</span>
          AI Admin Assistant
        </h3>
        <p class="header-subtitle">Powered by Google Gemini</p>
      </div>
      <div class="header-actions">
        <button class="header-btn" (click)="exportChat()" title="Export chat">
          ğŸ“¥
        </button>
        <button class="header-btn" (click)="clearChat()" title="Clear chat">
          ğŸ—‘ï¸
        </button>
        <button class="header-btn" (click)="toggleMinimize()" title="Minimize">
          ğŸ“¦
        </button>
        <button class="header-btn close-btn" (click)="toggleChat()" title="Close">
          âœ•
        </button>
      </div>
    </div>

    <!-- Messages Container -->
    <div class="chat-messages-container" *ngIf="!isMinimized()">
      <!-- Welcome State (Empty Chat) -->
      <div class="welcome-container" *ngIf="messages().length === 0">
        <div class="welcome-content">
          <div class="welcome-icon">ğŸš€</div>
          <h2>Welcome to AI Assistant</h2>
          <p>Ask me anything about your quiz platform analytics, user management, or system recommendations.</p>
        </div>
      </div>

      <!-- Messages -->
      <div class="messages-list">
        <div *ngFor="let message of messages()" 
             class="message" 
             [class.user-message]="message.role === 'user'"
             [class.assistant-message]="message.role === 'assistant'">
          
          <div class="message-avatar">
            <span *ngIf="message.role === 'user'">ğŸ‘¤</span>
            <span *ngIf="message.role === 'assistant'">ğŸ¤–</span>
          </div>
          
          <div class="message-content">
            <div class="message-text" *ngIf="!message.isLoading">
              <p [innerHTML]="formatContent(message.content)"></p>
            </div>
            
            <!-- Loading Indicator -->
            <div class="loading-indicator" *ngIf="message.isLoading">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </div>
          </div>
          
          <div class="message-timestamp">
            {{ message.timestamp | date:'HH:mm' }}
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Suggestions (show when chat is empty) -->
    <div class="quick-suggestions" *ngIf="messages().length <= 1 && !isMinimized()">
      <p class="suggestions-label">Quick Suggestions:</p>
      <div class="suggestions-grid">
        <button *ngFor="let suggestion of quickSuggestions"
                class="suggestion-btn"
                [class.selected]="selectedSuggestion() === suggestion"
                (click)="useSuggestion(suggestion)">
          {{ suggestion }}
        </button>
      </div>
    </div>

    <!-- Input Area -->
    <div class="chat-input-area" *ngIf="!isMinimized()">
      <div class="input-wrapper">
        <textarea 
          class="chat-input" 
          placeholder="Ask me anything about your dashboard... (Shift+Enter for new line)"
          [(ngModel)]="inputMessage"
          (keydown)="onInputKeydown($event)"
          [disabled]="isLoading()"
          rows="2"></textarea>
        <button class="send-btn" 
                (click)="sendMessage()" 
                [disabled]="!inputMessage().trim() || isLoading()"
                title="Send message (Enter)">
          <span *ngIf="!isLoading()">ğŸ“¤</span>
          <span *ngIf="isLoading()" class="sending">â³</span>
        </button>
      </div>
      <div class="input-hint">
        ğŸ’¡ Tip: Ask about dashboard trends, user analytics, quiz performance, or system recommendations
      </div>
    </div>
  </div>
</div>
