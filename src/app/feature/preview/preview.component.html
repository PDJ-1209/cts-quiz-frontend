<div class="preview-container">
  
  @if (showQuizList()) {
    <!-- Quiz List View -->
    <div class="quiz-list-section">
      <div class="preview-header">
        <div>
          <h2 class="mb-2">üìã My Quizzes</h2>
          <p class="text-muted mb-0">Host ID: {{ currentHostName }}</p>
        </div>
        <button class="btn btn-primary" (click)="startNewQuiz()" type="button">
          ‚ûï Create New Quiz
        </button>
      </div>

      @if (loadingQuizzes()) {
        <app-loader 
          type="cognizant" 
          text="Loading your quizzes..." 
          containerClass="inline">
        </app-loader>
      } @else if (hostQuizzes().length === 0) {
        <div class="empty-state">
          <div class="empty-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14,2 14,8 20,8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10,9 9,9 8,9"></polyline>
            </svg>
          </div>
          <h3>No quizzes found</h3>
          <p>You haven't created any quizzes yet. Use the button above to start a new quiz.</p>
        </div>
      } @else {
        <!-- Quiz Cards -->
        <div class="card shadow-sm">
          <div class="card-header bg-light">
            <h5 class="mb-0">üìã All Created Quizzes</h5>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead>
                  <tr>
                    <th>Quiz Number</th>
                    <th>Quiz Name</th>
                    <th>Category</th>
                    <th>Questions</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  @for (quiz of hostQuizzes(); track quiz.quizId) {
                    <tr>
                      <td><code class="text-primary">{{ quiz.quizNumber }}</code></td>
                      <td><strong>{{ quiz.quizName }}</strong></td>
                      <td><span class="badge bg-secondary">{{ quiz.category }}</span></td>
                      <td><span class="badge bg-info">{{ quiz.questionCount }}</span></td>
                      <td>
                        <span 
                          class="badge" 
                          [class.bg-warning]="quiz.status.toLowerCase() === 'draft'"
                          [class.bg-success]="quiz.status.toLowerCase() !== 'draft'">
                          {{ quiz.status }}
                        </span>
                      </td>
                      <td>{{ quiz.createdAt | date:'short' }}</td>
                      <td>
                        <div class="btn-group btn-group-sm">
                          <!-- <button 
                            class="btn btn-outline-primary"
                            (click)="loadQuizForEditing(quiz.quizId)" 
                            type="button">
                            ‚úèÔ∏è Edit
                          </button> -->
                          <button 
                            class="btn btn-outline-secondary"
                            (click)="toggleQR(quiz.quizId)" 
                            type="button">
                            {{ showQRForQuizId() === quiz.quizId ? 'Hide QR' : 'Show QR' }}
                          </button>
                        </div>
                      </td>
                    </tr>
                    @if (showQRForQuizId() === quiz.quizId) {
                      <tr>
                        <td colspan="7" class="qr-cell">
                          <app-qrcode 
                            [quizNumber]="quiz.quizNumber" 
                            [quizId]="quiz.quizId"
                            [showActions]="false">
                          </app-qrcode>
                        </td>
                      </tr>
                    }
                  }
                </tbody>
              </table>
            </div>
          </div>
        </div>
      }
    </div>
  } @else {
    <!-- Quiz Edit View -->
    <div class="quiz-edit-header">
      <button class="back-btn" (click)="backToQuizList()" type="button">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12,19 5,12 12,5"></polyline>
        </svg>
        Back to My Quizzes
      </button>
    </div>

    <!-- Existing Quiz Meta and Questions sections -->
  <div class="quiz-meta-card">
    <div class="card-header">
      <h2>Quiz Preview</h2>
    </div>
    
    @if (quizMeta(); as meta) {
      <div class="meta-info">
        <div class="meta-row">
          <span class="label">Quiz Name:</span>
          <span class="value">{{ meta.quizName || 'Not set' }}</span>
        </div>
        <div class="meta-row">
          <span class="label">Quiz Number:</span>
          <span class="value">{{ meta.quizNumber || 'Not generated' }}</span>
        </div>
        <div class="meta-row">
          <span class="label">Category:</span>
          <span class="value">{{ meta.category || 'Not set' }}</span>
        </div>
        <div class="meta-row">
          <span class="label">Total Questions:</span>
          <span class="value">{{ questions().length }}</span>
        </div>
      </div>
    } @else {
      <div class="no-meta">
        <p>No quiz information available. Please add quiz details in the Questions tab.</p>
      </div>
    }
  </div>

  <!-- Questions List -->
  <div class="questions-section">
    <div class="section-header">
      <h3>Questions</h3>
    </div>

    @if (questions().length === 0) {
      <div class="no-questions">
        <p>No questions added yet. Add questions in the Questions tab to see them here.</p>
      </div>
    } @else {
      <div class="questions-list">
        @for (question of questions(); let i = $index; track question.text) {
          <div class="question-card" [class.editing]="editingQuestionIndex() === i">
            
            @if (editingQuestionIndex() === i && editingQuestion(); as editQ) {
              <!-- Edit Mode -->
              <div class="edit-mode">
                <div class="question-header">
                  <h4>Edit Question #{{ i + 1 }}</h4>
                  <div class="edit-actions">
                    <button class="save-btn" (click)="saveQuestion()" type="button">Save</button>
                    <button class="cancel-btn" (click)="cancelEdit()" type="button">Cancel</button>
                  </div>
                </div>
                
                <div class="form-group">
                  <label>Question Text:</label>
                  <textarea [(ngModel)]="editQ.text" rows="3" class="form-control"></textarea>
                </div>
                
                <div class="form-row">
                  <div class="form-group">
                    <label>Type:</label>
                    <select [(ngModel)]="editQ.type" class="form-control">
                      <option value="Multiple Choice">Multiple Choice</option>
                      <option value="True/False">True/False</option>
                      <option value="Short Answer">Short Answer</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Difficulty:</label>
                    <select [(ngModel)]="editQ.difficulty" class="form-control">
                      <option value="Easy">Easy</option>
                      <option value="Medium">Medium</option>
                      <option value="Hard">Hard</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Timer (seconds):</label>
                    <input type="number" [(ngModel)]="editQ.timerSeconds" class="form-control" min="0">
                  </div>
                </div>

                @if (editQ.type !== 'Short Answer') {
                  <div class="options-section">
                    <div class="options-header">
                      <label>Options:</label>
                      <button class="add-option-btn" (click)="addOption()" type="button">Add Option</button>
                    </div>
                    
                    @for (option of editQ.options; let optIdx = $index; track optIdx) {
                      <div class="option-row">
                        <input type="text" [(ngModel)]="option.text" class="option-input" placeholder="Option text">
                        <label class="correct-label">
                          <input type="radio" [name]="'correct-' + i" [checked]="option.isCorrect" 
                                 (change)="setCorrectOption(optIdx)">
                          Correct
                        </label>
                        @if (editQ.options.length > 1) {
                          <button class="remove-option-btn" (click)="removeOption(optIdx)" type="button">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M18 6L6 18"></path>
                              <path d="M6 6l12 12"></path>
                            </svg>
                          </button>
                        }
                      </div>
                    }
                  </div>
                }
              </div>
            } @else {
              <!-- View Mode -->
              <div class="view-mode">
                <div class="question-header">
                  <div class="question-title">
                    <span class="question-number">#{{ i + 1 }}</span>
                    <h4>{{ question.text }}</h4>
                  </div>
                  <div class="question-actions">
                    <button class="edit-btn" (click)="startEditQuestion(i)" type="button">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                      </svg>
                    </button>
                    <button class="delete-btn" (click)="deleteQuestion(i)" type="button">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18"></path>
                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                      </svg>
                    </button>
                  </div>
                </div>
                
                <div class="question-meta">
                  <span class="badge badge-type">{{ question.type }}</span>
                  <span class="badge badge-difficulty">{{ question.difficulty }}</span>
                  <span class="badge badge-category">{{ question.category }}</span>
                  @if (question.timerSeconds) {
                    <span class="badge badge-timer">{{ question.timerSeconds }}s</span>
                  }
                </div>
                
                @if (question.options.length > 0) {
                  <div class="options-list">
                    @for (option of question.options; track option.text) {
                      <div class="option-item" [class.correct]="option.isCorrect">
                        <span class="option-text">{{ option.text }}</span>
                        @if (option.isCorrect) {
                          <span class="correct-indicator">‚úì Correct</span>
                        }
                      </div>
                    }
                  </div>
                }
              </div>
            }
          </div>
        }
      </div>
    }
  </div>

  }
</div>
