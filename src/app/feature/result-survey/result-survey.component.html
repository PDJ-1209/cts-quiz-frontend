<div class="survey-analytics-container">
  <!-- Navigation Bar -->
  <nav class="analytics-navbar">
    <div class="navbar-content">
      <h1 class="analytics-title">ğŸ“Š Survey Analytics</h1>
      <button class="export-btn" (click)="exportAnalytics()" title="Export Analytics">
        ğŸ“¥ Export
      </button>
    </div>
  </nav>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-overlay">
      <div class="spinner"></div>
      <p>Loading survey analytics...</p>
    </div>
  }

  <!-- Analytics Cards -->
  <div class="analytics-cards">
    <div class="analytics-card card-questions">
      <div class="card-icon">ğŸ“</div>
      <div class="card-content">
        <h3>{{ totalQuestions() }}</h3>
        <p>Total Questions</p>
      </div>
    </div>

    <div class="analytics-card card-participants">
      <div class="card-icon">ğŸ‘¥</div>
      <div class="card-content">
        <h3>{{ totalParticipants() }}</h3>
        <p>Total Participants</p>
      </div>
    </div>

    <div class="analytics-card card-published">
      <div class="card-icon">ğŸ“…</div>
      <div class="card-content">
        <h3>{{ publishedDate() }}</h3>
        <p>Published Date</p>
      </div>
    </div>

    <div class="analytics-card card-votes">
      <div class="card-icon">ğŸ—³ï¸</div>
      <div class="card-content">
        <h3>{{ totalVotes() }}</h3>
        <p>Total Votes</p>
      </div>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="search-section">
    <div class="search-container">
      <input 
        type="text" 
        class="search-input" 
        placeholder="Search questions..."
        [value]="searchQuery()"
        (input)="searchQuery.set($any($event.target).value)"
        (keyup.enter)="searchQuestions()">
      <button class="search-btn" (click)="searchQuestions()">
        ğŸ” Search
      </button>
    </div>
  </div>

  <!-- Question-wise Analytics Section -->
  <div class="question-analytics-section">
    <h2 class="section-title">ğŸ“ˆ Question-wise Analytics</h2>

    <div class="table-container">
      <table class="analytics-table">
        <thead>
          <tr>
            <th>Question Number</th>
            <th>Question</th>
            <th>Analytics</th>
          </tr>
        </thead>
        <tbody>
          @for (question of filteredQuestions(); track question.surveyQuestionId) {
            <tr>
              <td class="question-number">
                <span class="q-badge">Q{{ question.questionOrder }}</span>
              </td>
              <td class="question-text">{{ question.questionText }}</td>
              <td class="analytics-actions">
                <div class="action-group">
                  <button 
                    class="view-btn" 
                    (click)="toggleChartView(question.surveyQuestionId)"
                    title="Toggle Chart View">
                    {{ activeQuestionId() === question.surveyQuestionId ? 'ğŸ‘ï¸ Hide' : 'ğŸ‘ï¸ View' }}
                  </button>
                  
                  <select 
                    class="chart-type-select"
                    [(ngModel)]="selectedChartTypes[question.surveyQuestionId]"
                    (change)="onChartTypeChange(question.surveyQuestionId)"
                    [disabled]="activeQuestionId() !== question.surveyQuestionId">
                    <option value="pie">ğŸ¥§ Pie Chart</option>
                    <option value="line">ğŸ“ˆ Line Graph</option>
                    <option value="doughnut">ğŸ© Donut Chart</option>
                    <option value="wordcloud">â˜ï¸ Word Cloud</option>
                  </select>
                </div>
              </td>
            </tr>
            
            <!-- Chart Row (Expandable) -->
            @if (activeQuestionId() === question.surveyQuestionId) {
              <tr class="chart-row">
                <td colspan="3">
                  <div class="chart-container">
                    @if (selectedChartTypes[question.surveyQuestionId] === 'wordcloud') {
                      <div class="wordcloud-wrapper">
                        <canvas 
                          #wordcloudCanvas
                          [id]="'wordcloud-' + question.surveyQuestionId"
                          class="wordcloud-canvas">
                        </canvas>
                      </div>
                    } @else {
                      <div class="chart-wrapper">
                        <canvas 
                          [id]="'chart-' + question.surveyQuestionId"
                          class="analytics-chart">
                        </canvas>
                      </div>
                    }
                    
                    <button 
                      class="download-chart-btn"
                      (click)="downloadChart(question.surveyQuestionId)"
                      title="Download Chart">
                      ğŸ’¾ Download Chart
                    </button>
                  </div>
                </td>
              </tr>
            }
          }
          
          @if (filteredQuestions().length === 0) {
            <tr>
              <td colspan="3" class="no-results">
                <div class="empty-state">
                  <div class="empty-icon">ğŸ”</div>
                  <h3>No Results Found</h3>
                  <p>Try adjusting your search query</p>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>
