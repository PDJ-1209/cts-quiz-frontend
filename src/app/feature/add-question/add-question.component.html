<!-- ADD QUESTION COMPONENT - BOOTSTRAP LAYOUT -->
<div class="container-fluid">
  <div class="row g-4">

    <!-- MAIN CONTENT AREA (LEFT) -->
    <div class="col-lg-8">

      <!-- QUIZ NAME CARD -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0 text-white"><span class="me-2">üìù</span>Quiz Information</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Quiz Name *</label>
              <input type="text" class="form-control" [formControl]="form.controls.quizName"
                placeholder="e.g., Angular Fundamentals, React Basics" />
              @if (form.controls.quizName.invalid && form.controls.quizName.touched) {
              <div class="text-danger small mt-1">Quiz name is required</div>
              }
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Category</label>
              <input type="text" class="form-control" [formControl]="form.controls.category"
                placeholder="e.g., Angular, JavaScript" />
            </div>
          </div>
          @if (questions().length > 0) {
          <div class="text-muted mt-3">
            ‚ú® {{ questions().length }} question{{ questions().length > 1 ? 's' : '' }} added to "{{
            form.controls.quizName.value || 'this quiz' }}"
          </div>
          }
        </div>
      </div>

      <!-- ADD QUESTION CARD -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0 text-white"><span class="me-2">‚ùì</span>Add New Question</h5>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-light btn-sm" (click)="downloadSampleCSV()">
              üìÑ Sample CSV
            </button>
            <button type="button" class="btn btn-warning btn-sm" (click)="toggleSuggestion()">
              üí° Suggestions
            </button>
          </div>
        </div>
        <div class="card-body">
          <form [formGroup]="form">

            <!-- Question Text -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Question *</label>
              <textarea class="form-control" [formControl]="form.controls.question"
                placeholder="Enter your question here... (e.g., What is the capital of France?)" rows="3"></textarea>
              <div class="form-text">{{ form.controls.question.value.length || 0 }}/1000 characters</div>
              @if (form.controls.question.invalid && form.controls.question.touched) {
              <div class="text-danger small mt-1">Question is required (min 10 chars).</div>
              }
            </div>

            <!-- Question Type & Difficulty -->
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <label class="form-label fw-semibold">Question Type</label>
                <select class="form-select" [formControl]="form.controls.type">
                  @for (t of questionTypes; track t) {
                  <option [value]="t">{{ t }}</option>
                  }
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Difficulty</label>
                <select class="form-select" [formControl]="form.controls.difficulty">
                  @for (d of difficulties; track d) {
                  <option [value]="d">{{ d }}</option>
                  }
                </select>
              </div>
            </div>

            <!-- Options (hidden for Short Answer) -->
            @if (form.controls.type.value !== 'Short Answer') {
            <div class="mb-3">
              <label class="form-label fw-semibold">Answer Options *</label>
              @for (opt of options.controls; let i = $index; track i) {
              <div class="input-group mb-2" [formGroup]="opt">
                <div class="input-group-text">
                  <input type="checkbox" class="form-check-input mt-0" formControlName="correct">
                </div>
                <input class="form-control" type="text" formControlName="text" placeholder="Enter option text"
                  [readonly]="form.controls.type.value === 'True/False'" (focus)="clearPlaceholderText($event, i)" />
                @if (options.length > 2 && form.controls.type.value !== 'True/False') {
                <button type="button" class="btn btn-outline-danger" (click)="removeOption(i)"
                  title="Remove option">üóëÔ∏è</button>
                }
              </div>
              }
              @if (form.controls.type.value !== 'True/False') {
              <button type="button" class="btn btn-outline-primary btn-sm mt-2" (click)="addOption()">
                Ôºã Add Another Option
              </button>
              }
              @if (!hasAtLeastOneCorrect()) {
              <div class="text-danger small mt-1">Mark at least one option as correct.</div>
              }
            </div>
            }

            <!-- Tags -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Tags</label>
              <div class="d-flex flex-wrap gap-2 mb-2">
                @for (tagCtrl of tags.controls; let i = $index; track i) {
                <span class="badge bg-secondary">
                  {{ tagCtrl.value }}
                  <button type="button" class="btn-close btn-close-white ms-1" (click)="removeTag(i)"
                    style="font-size: 10px;"></button>
                </span>
                }
              </div>
              <div class="input-group">
                <input #tagInput type="text" class="form-control" placeholder="Add tag..." />
                <button type="button" class="btn btn-outline-secondary" (click)="addTag(tagInput)">Add</button>
              </div>
            </div>

            <!-- Timer -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Timer (seconds)</label>
              <input type="number" class="form-control" min="0" [formControl]="form.controls.timerSeconds"
                placeholder="Enter time in seconds" (keydown)="preventInvalidInput($event)" />
              @if (form.controls.timerSeconds.invalid && form.controls.timerSeconds.touched) {
              <div class="text-danger small mt-1">Must be a positive number.</div>
              }
            </div>

            <!-- Submit Button -->
            <div class="mt-4">
              <button type="button" class="btn btn-success w-100 py-3 fw-bold fs-5" (click)="onSubmit()" [disabled]="disableAdd()">
                ‚ûï Add Question
              </button>
            </div>

          </form>

          <!-- Suggestions -->
          @if (suggestionsOpen()) {
          <div class="card mt-3">
            <div class="card-body text-center text-muted">
              Suggestions will appear here (wire up your AI/logic).
            </div>
          </div>
          }
        </div>
      </div>

      <!-- PREVIEW CARD -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0 text-white"><span class="me-2">üëÅÔ∏è</span>Questions Preview ({{ questions().length }})</h5>
        </div>
        <div class="card-body">
          @if (questions().length === 0) {
          <div class="text-center py-5">
            <div class="display-1 mb-3">üìù</div>
            <p class="text-muted">No questions added yet. Create your first question above.</p>
          </div>
          } @else {
          <div class="list-group mb-3">
            @for (q of questions(); let i = $index; track q.text) {
            <div class="list-group-item">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <span class="badge bg-primary rounded-pill">Q{{ i + 1 }}</span>
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-outline-secondary" type="button" title="Edit">‚úèÔ∏è</button>
                  <button class="btn btn-outline-danger" type="button" (click)="deleteQuestion(i)"
                    title="Delete">üóëÔ∏è</button>
                </div>
              </div>
              <div class="fw-semibold mb-2">{{ q.text }}</div>
              @if (q.options.length) {
              <div class="d-flex flex-column gap-1">
                @for (opt of q.options; track opt.text) {
                <div class="badge" [class.bg-success]="opt.isCorrect" [class.bg-light]="!opt.isCorrect"
                  [class.text-dark]="!opt.isCorrect">
                  {{ opt.text }}
                </div>
                }
              </div>
              }
              <div class="d-flex gap-2 flex-wrap mt-2">
                <span class="badge bg-info">{{ q.type }}</span>
                <span class="badge bg-warning text-dark">{{ q.difficulty }}</span>
                <span class="badge bg-secondary">{{ q.category }}</span>
                @if (q.timerSeconds) {
                <span class="badge bg-dark">{{ q.timerSeconds }}s</span>
                }
              </div>
            </div>
            }
          </div>
          <button type="button" class="btn btn-primary w-100" (click)="publishFromPreview()" [disabled]="!canPublish()">
            üöÄ Create Quiz
          </button>
          @if (!canPublish()) {
          <div class="text-muted text-center mt-2 small">
            Add quiz basics and at least one question to enable publish.
          </div>
          }
          }
        </div>
      </div>

      <!-- QR CODE COMPONENT -->
      @if (isQuizCreated()) {
      <app-qrcode [quizNumber]="createdQuizNumber()" [quizId]="createdQuizId()" [showActions]="true"
        (newQuizClick)="startNewQuiz()">
      </app-qrcode>
      }

    </div>

    <!-- SIDEBAR (RIGHT) -->
    <div class="col-lg-4">

      <!-- QUIZ SUMMARY CARD -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0 text-white"><span class="me-2">üìä</span>Quiz Summary</h5>
        </div>
        <div class="card-body">
          <div class="list-group list-group-flush">
            <div class="list-group-item d-flex justify-content-between">
              <span>Questions</span>
              <span class="badge bg-primary rounded-pill">{{ questions().length }}</span>
            </div>
            <div class="list-group-item d-flex justify-content-between">
              <span>Quiz Name</span>
              <span class="fw-semibold">{{ form.controls.quizName.value || 'Untitled' }}</span>
            </div>
            @if (quizMeta(); as meta) {
            <div class="list-group-item d-flex justify-content-between">
              <span>Quiz Number</span>
              <span class="fw-semibold">{{ meta.quizNumber }}</span>
            </div>
            <div class="list-group-item d-flex justify-content-between">
              <span>Category</span>
              <span class="fw-semibold">{{ meta.category }}</span>
            </div>
            } @else {
            <div class="list-group-item text-muted">Enter quiz basics to generate Quiz Number.</div>
            }
          </div>
        </div>
      </div>

      <!-- CSV IMPORT CARD -->
      <div class="card shadow-sm">
        <div class="card-header bg-warning text-dark">
          <h5 class="mb-0 text-dark"><span class="me-2">üìÅ</span>CSV Import/Export</h5>
        </div>
        <div class="card-body text-center">
          <div class="fs-1 mb-3">‚ö°</div>
          <h6 class="fw-bold">Create Quiz Faster with CSV!</h6>
          <p class="text-muted small">Import multiple questions instantly from a CSV file.</p>
          <div class="d-grid gap-2">
            <button type="button" class="btn btn-outline-primary btn-sm" (click)="downloadSampleCSV()">
              üìã View Format
            </button>
            <button type="button" class="btn btn-outline-warning btn-sm" (click)="csvFileInput.click()">
              üìÅ Upload CSV
            </button>
            @if (questions().length > 0) {
            <button type="button" class="btn btn-outline-success btn-sm" (click)="exportToCSV()">
              üíæ Export Questions
            </button>
            }
          </div>
          <input type="file" accept=".csv" (change)="onCSVFileSelected($event)" #csvFileInput style="display: none;">
          <div class="text-muted small mt-2">{{ csvStatus() }}</div>
        </div>
      </div>

    </div>

  </div>
</div>